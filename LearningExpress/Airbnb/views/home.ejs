<!DOCTYPE html>
<html lang="en">
  <%- include('partials/head', { pageTitle: pageTitle || 'Airbnb Home' }); %>
  <body class="bg-gray-50 min-h-screen font-sans text-gray-800">
    <!-- Header -->
    <%- include('partials/header'); %>

    <!-- Page heading -->
    <header class="max-w-4xl mx-auto text-center mt-12 px-4">
      <h1 class="text-4xl font-semibold tracking-tight">Here are our registered homes</h1>
      <p class="mt-2 text-sm text-gray-500">Choose a home and reserve your stay.</p>
    </header>

    <!-- Controls + Homes list -->
    <main class="mt-8 flex justify-center px-4">
      <div class="bg-white shadow-lg rounded-xl p-6 w-full max-w-6xl">

        <!-- Controls row -->
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center space-x-2">
            <button aria-label="Map view" title="Map view" class="rounded-full border border-slate-300 p-2.5 text-slate-600 hover:text-white hover:bg-slate-800 transition" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17.93c-2.83-.48-5-2.75-5.58-5.58H11v-6h2v6h3.58c-.58 2.83-2.75 5.1-5.58 5.58V19.93z"/>
              </svg>
            </button>

            <button aria-label="Favorites" title="Favorites" class="rounded-full border border-slate-300 p-2.5 text-slate-600 hover:text-white hover:bg-slate-800 transition" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 6 4 4 6.5 4c1.54 0 3.04.99 3.57 2.36h.87C14.46 4.99 15.96 4 17.5 4 20 4 22 6 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
            </button>

            <button aria-label="List view" title="List view" class="rounded-full border border-slate-300 p-2.5 text-slate-600 hover:text-white hover:bg-slate-800 transition" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zm0-10v2h14V7H7z"/>
              </svg>
            </button>

            <button aria-label="Filters" title="Filters" class="rounded-full border border-slate-300 p-2.5 text-slate-600 hover:text-white hover:bg-slate-800 transition" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M10 18h4v-2h-4v2zm-7-8v2h18v-2H3zm3-6v2h12V4H6z"/>
              </svg>
            </button>

            <span class="rounded-full border border-slate-300 py-2 px-4 text-sm text-slate-600">+ 20</span>
          </div>

          <div class="w-36">
            <button id="reserveTopBtn" class="w-full rounded-md bg-slate-800 py-2 px-4 text-sm text-white hover:bg-slate-700 transition" type="button">
              Reserve
            </button>
          </div>
        </div>

        <!-- Two-column layout: Left = selected preview, Right = grid -->
        <section aria-labelledby="homes-heading" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <h2 id="homes-heading" class="sr-only">Available homes</h2>

          <!-- PREVIEW PANEL (LEFT) -->
          <div id="selected-panel" class="col-span-1 bg-gray-50 rounded-lg p-4 flex flex-col items-stretch justify-start">
            <div id="selected-empty" class="text-center text-gray-500 py-12">
              <p class="font-medium">No home selected</p>
              <p class="text-sm mt-2">Click a home on the right to view details</p>
            </div>

            <div id="selected-content" class="hidden flex flex-col space-y-4">
              <div class="h-64 bg-gray-200 rounded-md overflow-hidden">
                <img id="selected-img" src="/images/placeholder.png" alt="Selected home image" class="w-full h-full object-cover">
              </div>

              <div>
                <h3 id="selected-title" class="text-2xl font-semibold text-gray-800">Title</h3>
                <p id="selected-location" class="text-sm text-gray-500 mt-1">Location</p>
                <p id="selected-price" class="text-lg font-medium text-gray-800 mt-3">$0 / night</p>
                <p id="selected-rating" class="text-sm text-gray-500 mt-1"></p>
              </div>

              <div class="mt-4">
                <a id="selected-reserve" href="#" class="inline-block w-full text-center bg-red-600 hover:bg-red-700 text-white font-medium px-6 py-3 rounded-md transition">Reserve this home</a>
              </div>
            </div>
          </div>

          <!-- GRID (RIGHT) -->
          <div class="col-span-2">
            <% if (typeof homes !== 'undefined' && homes.length) { %>
              <div id="homes-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <% homes.forEach(function(home, idx) { %>
                  <article
                    class="home-card border rounded-lg overflow-hidden shadow-sm bg-white cursor-pointer transform hover:scale-105 transition"
                    data-index="<%= idx %>"
                    data-id="<%= home.id %>"
                    data-title="<%- (home.title ? home.title.replace(/"/g, '&quot;') : 'Untitled Home') %>"
                    data-location="<%- (home.location ? home.location.replace(/"/g, '&quot;') : 'Unknown location') %>"
                    data-price="<%= home.price ? home.price : '' %>"
                    data-image="<%- (home.image ? home.image : '/images/placeholder.png') %>"
                    data-rating="<%= home.rating ? home.rating : '' %>"
                    tabindex="0"
                    role="button"
                  >
                    <div class="h-44 bg-gray-100 overflow-hidden">
                      <img src="<%= home.image || '/images/placeholder.png' %>" alt="<%= home.title || 'Home image' %>" class="w-full h-full object-cover">
                    </div>
                    <div class="p-4">
                      <h3 class="text-lg font-semibold home-card-title"><%= home.title || 'Untitled Home' %></h3>
                      <p class="text-sm text-gray-500 mt-1"><%= home.location || 'Unknown location' %></p>
                      <div class="mt-3 flex items-center justify-between">
                        <p class="text-sm font-medium text-gray-800">
                          <%= home.price ? ('$' + home.price + ' / night') : 'Contact for price' %>
                        </p>
                        <button class="rounded-md bg-slate-800 py-1.5 px-3 text-sm text-white hover:bg-slate-700 transition" aria-label="Reserve <%= home.title %>">
                          Reserve
                        </button>
                      </div>
                    </div>
                  </article>
                <% }) %>
              </div>
            <% } else { %>
              <div class="text-center py-12">
                <p class="text-gray-500">No homes registered yet. Check back later or add a new home.</p>
              </div>
            <% } %>
          </div>
        </section>
      </div>

      <!-- CLIENT JS: handle click => populate preview -->
      <script>
        (function () {
          const grid = document.getElementById('homes-grid');
          if (!grid) return;

          const selectedEmpty = document.getElementById('selected-empty');
          const selectedContent = document.getElementById('selected-content');
          const selectedImg = document.getElementById('selected-img');
          const selectedTitle = document.getElementById('selected-title');
          const selectedLocation = document.getElementById('selected-location');
          const selectedPrice = document.getElementById('selected-price');
          const selectedRating = document.getElementById('selected-rating');
          const selectedReserve = document.getElementById('selected-reserve');
          const reserveTopBtn = document.getElementById('reserveTopBtn');

          function clearSelection() {
            document.querySelectorAll('.home-card.selected').forEach(el => el.classList.remove('selected', 'ring-2', 'ring-red-500'));
          }

          function handleSelect(cardEl) {
            if (!cardEl) return;
            clearSelection();
            cardEl.classList.add('selected', 'ring-2', 'ring-red-500');

            const img = cardEl.dataset.image || '/images/placeholder.png';
            const title = cardEl.dataset.title || 'Untitled Home';
            const location = cardEl.dataset.location || 'Unknown location';
            const price = cardEl.dataset.price ? ('$' + cardEl.dataset.price + ' / night') : 'Contact for price';
            const rating = cardEl.dataset.rating ? ('Rating: ' + cardEl.dataset.rating) : '';

            selectedImg.src = img;
            selectedImg.alt = title;
            selectedTitle.textContent = title;
            selectedLocation.textContent = location;
            selectedPrice.textContent = price;
            selectedRating.textContent = rating;

            const id = cardEl.dataset.id || '';
            selectedReserve.href = '/reserve/' + id;

            if (reserveTopBtn) {
              reserveTopBtn.onclick = () => { window.location.href = '/reserve/' + id; };
            }

            selectedEmpty.classList.add('hidden');
            selectedContent.classList.remove('hidden');
          }

          grid.addEventListener('click', function (e) {
            const card = e.target.closest('.home-card');
            if (card) handleSelect(card);
          });

          grid.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' || e.key === ' ') {
              const card = e.target.closest('.home-card');
              if (card) {
                e.preventDefault();
                handleSelect(card);
              }
            }
          });

          // auto-select first card if exists
          const firstCard = grid.querySelector('.home-card');
          if (firstCard) {
            handleSelect(firstCard);
          }
        })();
      </script>
    </main>

    <!-- Footer -->
    <%- include('partials/footer'); %>
  </body>
</html>
